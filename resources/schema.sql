CREATE TABLE FILMS
(
    FILM_ID      BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME         VARCHAR(255)                            NOT NULL,
    DESCRIPTION  VARCHAR(200),
    RELEASE_DATE date,
    DURATION     BIGINT,
    MPA_ID       BIGINT,
    CONSTRAINT CONSTRAINT_3 PRIMARY KEY (FILM_ID)
);

CREATE TABLE FILM_GENRES
(
    FILM_ID  BIGINT NOT NULL,
    GENRE_ID BIGINT NOT NULL,
    CONSTRAINT CONSTRAINT_C PRIMARY KEY (FILM_ID, GENRE_ID)
);

CREATE TABLE FILM_LIKES
(
    FILM_ID BIGINT NOT NULL,
    USER_ID BIGINT NOT NULL,
    CONSTRAINT CONSTRAINT_7A PRIMARY KEY (FILM_ID, USER_ID)
);

CREATE TABLE FRIENDSHIPS
(
    USER_ID   BIGINT      NOT NULL,
    FRIEND_ID BIGINT      NOT NULL,
    STATUS    VARCHAR(20) NOT NULL,
    CONSTRAINT CONSTRAINT_D4 PRIMARY KEY (USER_ID, FRIEND_ID)
);

CREATE TABLE GENRES
(
    GENRE_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME     VARCHAR(50)                             NOT NULL,
    CONSTRAINT CONSTRAINT_7 PRIMARY KEY (GENRE_ID)
);

CREATE TABLE MPA_RATINGS
(
    MPA_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME   VARCHAR(10)                             NOT NULL,
    CONSTRAINT CONSTRAINT_B PRIMARY KEY (MPA_ID)
);

CREATE TABLE USERS
(
    USER_ID  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    LOGIN    VARCHAR(100)                            NOT NULL,
    EMAIL    VARCHAR(255)                            NOT NULL,
    NAME     VARCHAR(255),
    BIRTHDAY date,
    CONSTRAINT CONSTRAINT_4 PRIMARY KEY (USER_ID)
);

ALTER TABLE USERS
    ADD CONSTRAINT CONSTRAINT_4D UNIQUE (EMAIL);

ALTER TABLE GENRES
    ADD CONSTRAINT CONSTRAINT_7D UNIQUE (NAME);

ALTER TABLE MPA_RATINGS
    ADD CONSTRAINT CONSTRAINT_B7 UNIQUE (NAME);

ALTER TABLE FILM_GENRES
    ADD CONSTRAINT FK_FILM_GENRES_FILM FOREIGN KEY (FILM_ID) REFERENCES FILMS (FILM_ID) ON DELETE CASCADE;

ALTER TABLE FILM_GENRES
    ADD CONSTRAINT FK_FILM_GENRES_GENRE FOREIGN KEY (GENRE_ID) REFERENCES GENRES (GENRE_ID) ON DELETE CASCADE;

ALTER TABLE FILM_LIKES
    ADD CONSTRAINT FK_FILM_LIKES_FILM FOREIGN KEY (FILM_ID) REFERENCES FILMS (FILM_ID) ON DELETE CASCADE;

ALTER TABLE FILM_LIKES
    ADD CONSTRAINT FK_FILM_LIKES_USER FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE;

ALTER TABLE FRIENDSHIPS
    ADD CONSTRAINT FK_FRIENDSHIP_FRIEND FOREIGN KEY (FRIEND_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE;

ALTER TABLE FRIENDSHIPS
    ADD CONSTRAINT FK_FRIENDSHIP_USER FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE;

ALTER TABLE FILMS
    ADD CONSTRAINT FK_MPA FOREIGN KEY (MPA_ID) REFERENCES MPA_RATINGS (MPA_ID) ON DELETE RESTRICT;